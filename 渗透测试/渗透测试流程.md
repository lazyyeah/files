# 目录

[1收集测试范围 1](#_Toc53394160)

[1.1调查咨询得到需要测试的资产范围 1](#_Toc53394161)

[1.2 Dirmap 获得需要渗透的资产子目录 2](#_Toc53394162)

[1.3 Masscan 获得需要渗透的资产的端口开放情况 3](#_Toc53394163)

[1.4 Fofa 从外网情报收集查看是否有信息 3](#_Toc53394164)

[1.5 Shodan从外网情报收集查看是否有信息 4](#_Toc53394165)

[2 弱口令测试 4](#_Toc53394166)

[2.1 访问页面，测试登录弱口令，查看是否为管理页面对外暴露导致信息泄露 4](#_Toc53394167)

[2.2 咨询是否有弱口令 4](#_Toc53394168)

[2.3 弱口令爆破 5](#_Toc53394169)

[3 AWVS扫描 5](#_Toc53394170)

[3.1新建扫描 5](#_Toc53394171)

[3.2开始扫描 6](#_Toc53394172)

[3.3设置扫描时的UA 6](#_Toc53394173)

[3.4设置扫描选项，选择全扫 7](#_Toc53394174)

[3.5扫描结果 7](#_Toc53394175)

[4 xray扫描 8](#_Toc53394176)

[5 WDscanner扫描 9](#_Toc53394177)

[6 手动测试xss注入 10](#_Toc53394178)

[7 手动测试设计缺陷 11](#_Toc53394179)

[7.1 登陆策略 11](#_Toc53394180)

[7.1.1 短信验证码不允许明文显示 11](#_Toc53394181)

[7.1.2 登录反馈不允许提示&quot;用户不存在&quot; 12](#_Toc53394182)

[7.1.3 忘记密码、找回密码逻辑是否有缺陷 12](#_Toc53394183)

[7.1.4 图片验证码id替代漏洞，图片验证码过于简单 12](#_Toc53394184)

[7.2 业务数据重放攻击 14](#_Toc53394185)

[7.3 越权测试（水平、垂直） 15](#_Toc53394186)

[7.4 短信炸弹，邮件炸弹漏洞 15](#_Toc53394187)

# 1收集测试范围

## 1.1调查咨询得到需要测试的资产范围

## 1.2 Dirmap 获得需要渗透的资产子目录

Python dirmap.py -I [http://111.6.121.31:38083/](http://111.6.121.31:38083/) -lcf

![](RackMultipart20210507-4-ud8qpr_html_d2963760bc6b12a2.png)

## 1.3 Masscan 获得需要渗透的资产的端口开放情况

masscan -p0-65535 111.6.121.31,111.6.121.33,111.6.121.34,111.6.121.35 --rate=100

![](RackMultipart20210507-4-ud8qpr_html_abaec4f9095d5216.png)

对外开放的22、445、3306、3389等端口进行预计提醒

## 1.4 Fofa 从外网情报收集查看是否有信息

![](RackMultipart20210507-4-ud8qpr_html_28270e40ac83d286.png)

## 1.5 Shodan从外网情报收集查看是否有信息

![](RackMultipart20210507-4-ud8qpr_html_b896dbb73fa05e5e.png)

总结，第一步进行信息收集，将URL、IP、端口、对外暴露服务等统计再测试。

# 2 弱口令测试

## 2.1 访问页面，测试登录弱口令，查看是否为管理页面对外暴露导致信息泄露

![](RackMultipart20210507-4-ud8qpr_html_19ac27e22091df2f.png)

备注：对redis、mongodb等服务也要去测试是否有弱口令。

## 2.2 咨询是否有弱口令

| 地址 | 111.\*\*.\*\*.\*\*:38081 |
| --- | --- |
| 用户 | Uvpn |
| 密码 | 12\*\*\*\*\*\*\*# |

## 2.3 弱口令爆破

登陆页面使用burpsuite或python爆破 ![](RackMultipart20210507-4-ud8qpr_html_1c89d09d05c62211.gif)

Mysql等服务用python或hydra爆破

# 3 AWVS扫描

![](RackMultipart20210507-4-ud8qpr_html_79bf434209d2e6b.png)

## 3.1新建扫描

![](RackMultipart20210507-4-ud8qpr_html_97a552f22ef245a4.png)

## 3.2开始扫描

![](RackMultipart20210507-4-ud8qpr_html_1decd30f2eb8c50a.png)

## 3.3设置扫描时的UA

![](RackMultipart20210507-4-ud8qpr_html_bf76e2cd6d54395d.png)

## 3.4设置扫描选项，选择全扫

![](RackMultipart20210507-4-ud8qpr_html_7b6d4c82c951d6d.png)

## 3.5扫描结果

![](RackMultipart20210507-4-ud8qpr_html_b283e9077f7438fe.png)

# 4 xray扫描

![](RackMultipart20210507-4-ud8qpr_html_af0de8fa82689747.png)

xray\_windows\_amd64.exe webscan --url-file 1.csv --html-output puyang.html

![](RackMultipart20210507-4-ud8qpr_html_ea8d88e83f8571ae.png)

代理模式扫描：[https://docs.xray.cool/#/tutorial/webscan\_proxy](https://docs.xray.cool/#/tutorial/webscan_proxy)

xray\_windows\_amd64.exe webscan --listen 127.0.0.1:7777 --html-output xray-testphp.html

![](RackMultipart20210507-4-ud8qpr_html_6a3d50489f82acd4.jpg)

![](RackMultipart20210507-4-ud8qpr_html_9ecf597d69a3165d.gif)

# 5 WDscanner扫描

WDscanner扫描核心库使用了secscanner+w3af+awvs三款工具

https://github.com/TideSec/WDScanner

![](RackMultipart20210507-4-ud8qpr_html_cd85fed544a4e7d3.png)

![](RackMultipart20210507-4-ud8qpr_html_aa3347376968496d.png)

![](RackMultipart20210507-4-ud8qpr_html_dea3edd9b14da015.gif)

# 6 手动测试xss注入

![](RackMultipart20210507-4-ud8qpr_html_cac7352f3e313862.png)

![](RackMultipart20210507-4-ud8qpr_html_9c88f928290acad2.png)

# 7 手动测试设计缺陷

## 7.1 登陆策略

### 7.1.1 短信验证码不允许明文显示

![](RackMultipart20210507-4-ud8qpr_html_4ea00816ce76c723.png)

### 7.1.2 登录反馈不允许提示&quot;用户不存在&quot;

![](RackMultipart20210507-4-ud8qpr_html_9ec8eea265c36fb.png)

### 7.1.3 忘记密码、找回密码逻辑是否有缺陷

### 7.1.4 图片验证码id替代漏洞，图片验证码过于简单

图片id固定

![](RackMultipart20210507-4-ud8qpr_html_ffff17dd7b322c8c.png)

图片验证码明文显示

![](RackMultipart20210507-4-ud8qpr_html_5d65fee1456177aa.png)

## 7.2 业务数据重放攻击

![](RackMultipart20210507-4-ud8qpr_html_80270337973edf6f.png)

![](RackMultipart20210507-4-ud8qpr_html_446254465800a8fb.png)

![](RackMultipart20210507-4-ud8qpr_html_6d820e9982fa8c01.png)

## 7.3 越权测试（水平、垂直）

如当前权限可以查看id=2，修改url为id=3是否可以查看？

[https://sec.didichuxing.com/user?id=2](https://sec.didichuxing.com/user?id=2)

![](RackMultipart20210507-4-ud8qpr_html_bb794cb524984380.png)

| **漏洞名称** | 纵向越权 |
| --- | --- |
| **漏洞等级** | 中 |
| **漏洞位置** | http://jkverview |
| **漏洞描述** | 纵向越权是指用户向上获取了更高级别权限用户才能使用或读取的数据信息。结合本系统，普通管理员账号在首页可以浏览超级管理员账户的图表信息。 |
| **问题描述及风险分析** | **实现步骤：**
 ![](RackMultipart20210507-4-ud8qpr_html_3db2b983a3719e8.png)首先以超级管理员登录系统，可以看到仪表盘显示如下设置代理，利用burpsuite设置代理，在burpsuite里面观察一下数据包：
 ![](RackMultipart20210507-4-ud8qpr_html_6f78b325ad0e6c1d.png)接下来不修改数据包，正常登录普通管理员账户 ![](RackMultipart20210507-4-ud8qpr_html_8ff899903a5fb4a1.png)可以看到仪表盘显示如下，退出登录，重新登录，此时修改响应包内容如下 ![](RackMultipart20210507-4-ud8qpr_html_5abea5fbd91d617.png)放行之后观察首页 ![](RackMultipart20210507-4-ud8qpr_html_87285afa5d6d840.png)成功读取到了超级管理员的首页内容 |
| **修复建议** | **加固建议：**
1. 建议对返回数据进行加密处理不以明文显示。
2. 建议响应包内容仅作为回包显示用，不作为判断对变量。
 |
| **修复情况** | 初测，未修复 |

| **漏洞名称** | 明文传输 |
| --- | --- |
| **漏洞等级** | 中 |
| **漏洞位置** | 全站，以下以httgin为例 |
| **漏洞描述** | 明文传输是指系统在数据传输过程中，采用明文传输系统数据，其中关键数据未加密或加密措施较弱。 |
| **问题描述及风险分析** | **实现步骤：** 设置代理，利用burpsuite设置代理，输入用户名密码以后进行截包： ![](RackMultipart20210507-4-ud8qpr_html_7810dc56a531a775.png)
通过数据包可以看到全站采用http进行数据传输，其中password字段仅采用了MD5加密，被碰撞破解的可能性较大。 ![](RackMultipart20210507-4-ud8qpr_html_7a8f0262d81cca99.png)查看响应包，会发现用户session、id值等敏感信息均可获取 ![](RackMultipart20210507-4-ud8qpr_html_2541af9457096eef.png)其中usersessionId在A用户未退出的情况下可以直接被B用户复用 |
| **修复建议** | **加固建议：** 建议按照网站的密级要求，需要对密码传输过程中进行加密建议使用加密的方式传输，如使用HTTPS，。如果无法完成改造HTTPS，可以在网站前端用 Javascript 做强密码加密（如RSA），加密后再进行传输。 |
| **修复情况** | 初测，未修复 |

## 7.4 短信炸弹，邮件炸弹漏洞

对短信、邮件接口频繁访问，是否可以造成炸弹攻击。

![](RackMultipart20210507-4-ud8qpr_html_6dd5723984bf0c27.png)
